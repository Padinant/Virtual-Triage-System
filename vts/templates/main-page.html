{% extends "base.html" %}

{% set header_eyebrow_class = 'top-header-2-eyebrow-main' %}
{% set header_heading_class = 'top-header-2-heading-main' %}

{% block title %}{{ title }}{% endblock %}

{% block styles %}
    <link href="/main-page.css" rel="stylesheet" />
{% endblock %}{% block content %}
  <!-- Page title with admin link -->
  <div class="page-title-container">
    <h1 class="page-title page-title-main">Got Questions? We Have Answers!</h1>
    {% if admin %}
    <a href="{{ url_for('faq_page') }}" class="admin-faq-link">Manage Your FAQs as an Admin</a>
    {% endif %}
  </div>
    <p>
      Welcome to the UMBC CSEE Interactive Help system! This tool is designed
      to help you quickly find answers to common questions about the Computer
      Science and Electrical Engineering department.
    </p>

    <!-- Faq search bar section -->
    <form class="faq-search" id="faq-search" action="{{ url_for('faq_page') }}">
      <!-- Input field -->
      <input
        autocomplete="off"
        class="faq-search-input"
        id="faq-query"
        name="query"
        placeholder="Search FAQs..."
        type="search"
      />
      <!-- Search button -->
      <button class="faq-search-submit" id="faq-search-button" type="submit">
        Search
      </button>
    </form>

    <!-- Faq lookup section -->
    <div class="faq-lookup" id="faq-lookup"></div>
    <h2 class="faq-lookup-heading">Frequently Asked Questions</h2>
    <section class="faq-panel">
      <ul class="faq-list">
        {% for item in faq_items %}
          <!-- Clickable FAQ entry -->
          <li class="faq-list-item">
            <a class="faq-list-link" href="#" data-faq-id="{{ item.url.split('/')[-1] }}">{{ item.text | safe }}</a>
          </li>
        {% endfor %}
      </ul>
    </section>

    <!-- Popup overlay for FAQ display -->
    <div id="faq-popup" class="faq-popup">
      <div class="faq-popup-content">
        <a id="faq-popup-open" class="faq-popup-open" href="#" role="button">Go to FAQ</a>
        <button class="faq-popup-close">&times;</button>
        <div id="faq-popup-body" class="faq-popup-body">
          <!-- Faq content inserted here -->
        </div>
      </div>
    </div>

    <!-- Hidden FAQ data for modal -->
    <div id="faq-data" style="display: none;">
      {% for item in faq_full_items %}
        <div data-faq-id="{{ item.id }}" class="faq-data-item">
          {{ item.text | safe }}
        </div>
      {% endfor %}
    </div>

    <!-- Howto section -->
    <h2 class="section-heading section-heading-howto">
      How To Use This Tool
    </h2>
    <p class="indent">
      Browse through our Frequently Asked Questions (FAQ) by scrolling through
      the list on the home page, or use the search bar to find specific topics.
      Click on any question to view its detailed answer. If you need more
      personalized assistance, try our chatbot feature by clicking "Ask Chatbot"
      in the menu or the retriever icon in the bottom right corner. The chatbot
      can help answer your questions in real-time and guide you to the right
      resources. For quick access to department contact information and
      additional resources, visit the "Contact Us" link in the navigation menu.
    </p>

    <!-- Contact info section -->
    <h2 class="section-heading section-heading-contact">
      Contact Information
    </h2>
    <p>
      <span class="contact-label">Location</span><br />
      CSEE Main Office: ITE 325<br />
      1000 Hilltop Circle<br />
      Baltimore, MD 21250
    </p>
    <p>
      <span class="contact-label">Contact</span><br />
      Phone: 410-455-3500
    </p>

    <!-- Admin links section -->
    {% if admin_items %}
      {% for item in admin_items %}
        <p>
          <a class="admin-link" href="{{ item.url }}">{{ item.name }}</a>
        </p>
      {% endfor %}
    {% endif %}
{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const popup = document.getElementById('faq-popup');
  const popupBody = document.getElementById('faq-popup-body');
  const popupOpenLink = document.getElementById('faq-popup-open');
  const closeBtn = document.querySelector('.faq-popup-close');
  const faqLinks = document.querySelectorAll('.faq-list-link');
  
  // Open popup when FAQ link is clicked
  faqLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const faqId = this.getAttribute('data-faq-id');
      const faqData = document.querySelector(`#faq-data [data-faq-id="${faqId}"]`);
      
      if (faqData) {
        popupBody.innerHTML = faqData.innerHTML;
        // A button to go to the full FAQ page
        if (popupOpenLink) {
          popupOpenLink.href = `/faq/${faqId}`;
          popupOpenLink.style.display = 'inline-block';
        }
        popup.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent background scroll
      }
    });
  });
  
  // Close popup when X button is clicked
  closeBtn.addEventListener('click', function() {
    popup.classList.remove('show');
    document.body.style.overflow = ''; // Restore scroll
    if (popupOpenLink) {
      popupOpenLink.href = '#';
      popupOpenLink.style.display = 'none';
    }
  });
  
  // Close popup when clicking outside the content
  popup.addEventListener('click', function(e) {
    if (e.target === popup) {
      popup.classList.remove('show');
      document.body.style.overflow = '';
      if (popupOpenLink) {
        popupOpenLink.href = '#';
        popupOpenLink.style.display = 'none';
      }
    }
  });
  
  // Close popup with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && popup.classList.contains('show')) {
      popup.classList.remove('show');
      document.body.style.overflow = '';
      if (popupOpenLink) {
        popupOpenLink.href = '#';
        popupOpenLink.style.display = 'none';
      }
    }
  });
});
</script>
{% endblock %}

{% block chatbot_widget %}
    {% include "chatbot-widget.html" %}
{% endblock %}
