{% extends "base.html" %}

{% set header_eyebrow_class = 'top-header-2-eyebrow-admin-faq' %}
{% set header_heading_class = 'top-header-2-heading-admin-faq' %}

{% block title %}{{ title }}{% endblock %}

{% block styles %}
  <link href="/admin-faq-search.css" rel="stylesheet" />
{% endblock %}

{% block content %}
    <!-- Page title -->
    <h1 class="page-title page-title-admin-faq">Admin FAQ</h1>

    <!-- Admin search form -->
    <form class="faq-search" id="admin-faq-search" action="{{ url_for('faq_page') }}">
      <!-- Input field -->
      <input
        autocomplete="off"
        class="faq-search-input"
        id="admin-faq-query"
        name="query"
        placeholder="Search admin FAQs..."
        type="search"
        value="{{ query | default('', true) }}"
      />
      <!-- Search button -->
      <button class="faq-search-submit" id="admin-faq-search-button" type="submit">
        Search
      </button>
    </form>

    <!-- Dropdown menu for admin FAQ topics -->
    <div class="faq-controls">
      <details class="faq-dropdown">
      <summary class="faq-dropdown-toggle">{{ selected_category }}
        <svg class="chevron icon" viewBox="0 0 24 24" focusable="false">
          <use href="/static/ICONS/sprite.svg#chevron-down"></use>
        </svg>
      </summary>
      <ul class="faq-dropdown-list">
      {%for item in category_items %}
        <li><a class="faq-dropdown-link" href="{{ url_for('faq_page') }}?category={{ item.id }}">{{ item.category_name }}</a></li>
      {% endfor %}
      </ul>
      </details>

      <!-- View all button -->
      <a class="faq-search-submit" role="button" href="{{ url_for('faq_page') }}">View All</a>

      <!-- Edit categories button -->
      <a class="admin-action-button admin-action-button-edit-cats" role="button" href="{{ url_for('category_admin') }}">
        <span class="btn-icon">
          <svg class="icon" viewBox="0 0 24 24" focusable="false">
            <use href="/static/ICONS/sprite.svg#edit"></use>
          </svg>
        </span>
        Edit Categories
      </a>
        <div style="flex:1 1 auto"></div>

        <!-- Add FAQ button -->
        <a class="admin-action-button admin-action-button-add" role="button" href="{{ url_for('faq_admin_add') }}">
          <span class="btn-icon">
            <svg class="icon" viewBox="0 0 24 24" focusable="false">
              <use href="/static/ICONS/sprite.svg#add-file"></use>
            </svg>
          </span>
          Add FAQ
        </a>
    </div>

    {% if test_db %}
    <div class="faq-controls">
      <!-- Reset Test DB button -->
        <a class="admin-action-button admin-action-button-remove" role="button" href="{{ url_for('admin_reset_test_db') }}">
          <span class="btn-icon">
            <svg class="icon" viewBox="0 0 24 24" focusable="false">
              <use href="/static/ICONS/sprite.svg#delete"></use>
            </svg>
          </span>
          Reset Test DB
        </a>
    </div>
    {% endif %}

    {% for item in faq_items %}
      <!-- Admin FAQ entry with actions -->
      <section class="admin-faq-entry">
        <div class="admin-faq-heading-row">
          <div class="admin-faq-metadata">
            <h2 class="section-heading">FAQ Entry ID: {{ item.id }}</h2>
            <p class="admin-faq-info">Author: {{ item.author }}</p>
            <p class="admin-faq-info">Timestamp: {{ item.timestamp }}</p>
            <p class="admin-faq-info">Priority: {{ item.priority }}</p>
            <p class="admin-faq-info">Category: <a class="admin-faq-category-link" href="{{ url_for('faq_page') }}?category={{ item.category_id }}">{{ item.category }}</a></p>
          </div>
          <div class="admin-action-group">
            <a class="admin-action-button admin-action-button-edit" role="button" href="{{ url_for('faq_admin_edit', faq_id=item.id) }}">
              <span class="btn-icon">
                <svg class="icon" viewBox="0 0 24 24" focusable="false">
                  <use href="/static/ICONS/sprite.svg#edit"></use>
                </svg>
              </span>
              Edit
            </a>
            <a class="admin-action-button admin-action-button-remove" role="button" href="{{ url_for('faq_admin_remove', faq_id=item.id) }}">
              <span class="btn-icon">
                <svg class="icon" viewBox="0 0 24 24" focusable="false">
                  <use href="/static/ICONS/sprite.svg#delete"></use>
                </svg>
              </span>
              Remove
            </a>
          </div>
        </div>
        <div class="admin-faq-body">
          {{ item.text | safe }}
        </div>
      </section>
    {% endfor %}
{% endblock %}

{% block chatbot_widget %}
  {% include "chatbot-widget.html" %}
{% endblock %}
