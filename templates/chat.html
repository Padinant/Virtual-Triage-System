{% extends "base.html" %}

{% set header_eyebrow_class = 'top-header-2-eyebrow-main' %}
{% set header_heading_class = 'top-header-2-heading-main' %}

{% block title %}FAQ Chat Page{% endblock %}

{% block styles %}
    <link href="{{ url_for('static', filename='css/MainPage.css') }}" rel="stylesheet" />
    <style>
      /* chat container */
      .chat-wrapper {
        background: var(--white);
        border: 1px solid var(--umbcLightGray);
        border-radius: 12px;
        margin: 24px 0;
        padding: 24px;
        max-width: 720px;
      }
      .chat-row {
        display: flex;
        gap: 12px;
      }
      /* input + button alignment */
      .chat-input,
      .chat-send {
        font-size: 1rem;
        padding: 10px 12px;
      }
      .chat-input {
        border: 2px solid var(--umbcLightGray);
        border-radius: 8px;
        flex: 1 1 auto;
      }
      .chat-input:focus {
        border-color: var(--umbcGold);
        outline: none;
      }
      .chat-send {
        background: var(--umbcBlack);
        border: none;
        border-radius: 8px;
        color: var(--white);
        cursor: pointer;
      }
      .chat-send:hover {
        background: var(--umbcDarkGray);
      }
      /* chat transcript styling */
      .chat-messages {
        margin-top: 20px;
        max-height: 480px;
        overflow-y: auto;
      }
      .chat-message {
        border: 1px solid var(--umbcGold);
        border-radius: 8px;
        margin: 8px 0;
        padding: 10px;
      }
    </style>
{% endblock %}

{% block content %}
    <!-- interactive chat interface -->
    <h1 class="page-title">Interactive FAQ Chat</h1>
    <div class="chat-wrapper">
      <div class="chat-row">
        <input id="chat-text" class="chat-input" placeholder="Type a message..." autocomplete="off" />
        <button id="chat-send" class="chat-send" type="button">Send</button>
      </div>
      <div id="chat-messages" class="chat-messages"></div>
    </div>
{% endblock %}

{% block page_scripts %}
    <script>
      // Here is some JavaScript code to handle chat messages
      const input = document.getElementById('chat-text');
      const sendButton = document.getElementById('chat-send');
      const messages = document.getElementById('chat-messages');

      function addBubble(text, who) {
        const div = document.createElement('div');
        div.className = 'chat-message';
        div.textContent = (who === 'you' ? 'You: ' : 'CSEE Bot: ') + text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      async function send() {
        const text = input.value.trim();
        if (!text) {
          return;
        }
        addBubble(text, 'you');
        input.value = '';
        try {
          const res = await fetch('{{ url_for("message") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
          });
          const data = await res.json();
          addBubble(data.reply, 'bot');
        } catch (error) {
          // fallback message when the network request fails
          addBubble('Sorry, something went wrong. Please try again.', 'bot');
        }
      }

      sendButton.addEventListener('click', send);
      // execute the send function after pressing Enter
      input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          send();
        }
      });
    </script>
{% endblock %}
